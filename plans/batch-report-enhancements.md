# Batch Report Enhancements - Cold-Start Implementation Plan

**Status**: Phase 1 Complete (4/9 tasks) | Phase 2 Pending
**Last Updated**: 2025-11-24
**Assignee**: Any LLM agent
**Estimated Effort**: 3-4 hours

---

## Context

The multi-repository HTML report (`index.html`) generated by `agentready assess-batch` needs additional improvements to provide better insights and usability. Phase 1 (basic improvements) is complete. This plan covers the remaining Phase 2 enhancements.

**Completed in Phase 1**:
- ‚úÖ Added lowest/highest score repositories to summary statistics
- ‚úÖ Moved version and batch ID to header
- ‚úÖ Updated BatchSummary data model with min/max fields
- ‚úÖ Fixed git clone compatibility issue (removed --no-hooks)

**Remaining Work** (this plan):
- Add certification tier descriptions
- Reposition repository table below certification section
- Add table sorting and filtering (JavaScript)
- Implement seaborn-style heatmap for failing attributes
- Convert to 2-column layout
- Create separate detailed comparison page (future)

---

## Phase 2: Enhanced Reporting

### Task 1: Add Certification Tier Descriptions

**File**: `src/agentready/templates/multi_report.html.j2`

**Objective**: Add 2-3 sentence descriptions under each certification badge explaining what the tier means.

**Implementation**:

1. **Locate the certification distribution section** (around line 268):
```jinja2
{% if batch_assessment.summary.score_distribution %}
<h2>üèÜ Certification Distribution</h2>
<ul class="cert-list">
{% for cert, count in batch_assessment.summary.score_distribution.items() %}
    {% if count > 0 %}
    <li>
        <span class="badge {{ cert.lower().replace(' ', '-') }}">{{ cert }}</span>
        <strong>{{ count }}</strong> {{ 'repository' if count == 1 else 'repositories' }}
    </li>
    {% endif %}
{% endfor %}
</ul>
{% endif %}
```

2. **Add CSS for cert-description**:
```css
.cert-list li {
    padding: 1rem;
    margin-bottom: 0.75rem;
    border-left: 4px solid var(--color-primary);
    background: #f9f9f9;
    border-radius: 4px;
}

.cert-description {
    font-size: 0.85rem;
    color: var(--color-text-light);
    margin-top: 0.5rem;
    line-height: 1.4;
}
```

3. **Update the list items** with descriptions:
```jinja2
<li>
    <div>
        <span class="badge {{ cert.lower().replace(' ', '-') }}">{{ cert }}</span>
        <strong>{{ count }}</strong> {{ 'repository' if count == 1 else 'repositories' }}
    </div>
    {% if cert == 'Platinum' %}
    <div class="cert-description">
        Exemplary agent-ready codebase with comprehensive documentation, testing, and automation (90-100 score). Represents best practices across all categories.
    </div>
    {% elif cert == 'Gold' %}
    <div class="cert-description">
        Highly optimized for AI-assisted development with strong documentation and code quality (75-89 score). Minor improvements needed.
    </div>
    {% elif cert == 'Silver' %}
    <div class="cert-description">
        Well-suited for agent development with solid foundations (60-74 score). Some attributes need attention.
    </div>
    {% elif cert == 'Bronze' %}
    <div class="cert-description">
        Basic agent compatibility present but significant improvements needed across multiple areas (40-59 score).
    </div>
    {% elif cert == 'Needs Improvement' %}
    <div class="cert-description">
        Substantial friction for AI assistants (&lt;40 score). Requires foundational improvements in documentation and structure.
    </div>
    {% endif %}
</li>
```

**Verification**: Open report and verify each certification tier shows appropriate description.

---

### Task 2: Reposition Repository Table

**File**: `src/agentready/templates/multi_report.html.j2`

**Objective**: Move the repository results table to appear immediately after the certification distribution section.

**Current Order**:
1. Summary Statistics
2. Certification Distribution
3. Language Distribution
4. Top Failing Attributes
5. Repository Results ‚Üê currently here
6. Failed Assessments

**New Order**:
1. Summary Statistics
2. Certification Distribution
3. **Repository Results** ‚Üê move here
4. Language Distribution + Top Failing Attributes (side-by-side)
5. Failed Assessments

**Implementation**:

1. **Find the Repository Results section** (around line 292):
```jinja2
<h2>üìã Repository Results</h2>
{% if batch_assessment.results %}
<table>
...
</table>
{% endif %}
```

2. **Cut this entire section** (from `<h2>üìã Repository Results</h2>` to the closing `{% endif %}`)

3. **Paste it immediately after** the certification distribution section closing `{% endif %}`

4. **Add introductory text** with link to definitions:
```jinja2
<h2>üìã Repository Results</h2>
<p class="section-intro">
    Each repository is assessed against agent-ready best practices. Click repository name for detailed reports.
    <a href="https://github.com/ambient-code/agentready/blob/main/agent-ready-codebase-attributes.md" target="_blank">View complete attribute definitions ‚Üí</a>
</p>
```

5. **Add CSS for section-intro**:
```css
.section-intro {
    color: var(--color-text-light);
    font-size: 0.9rem;
    margin-bottom: 1rem;
    line-height: 1.5;
}

.section-intro a {
    color: #2196F3;
    text-decoration: none;
}

.section-intro a:hover {
    text-decoration: underline;
}
```

**Verification**: Verify table appears below certification section in rendered HTML.

---

### Task 3: Add Table Sorting and Filtering

**File**: `src/agentready/templates/multi_report.html.j2`

**Objective**: Make the repository results table sortable by clicking column headers and filterable via search box.

**Implementation**:

1. **Update CSP header** to allow inline scripts:
```html
<meta http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'unsafe-inline'; object-src 'none'; style-src 'unsafe-inline';">
```

2. **Add filter box CSS**:
```css
.filter-box {
    margin-bottom: 1rem;
    padding: 1rem;
    background: #f9f9f9;
    border-radius: 6px;
}

.filter-box input {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid var(--color-border);
    border-radius: 4px;
    font-size: 0.9rem;
}

th {
    cursor: pointer;
    user-select: none;
    position: relative;
}

th:hover {
    background-color: #45a049;
}

th::after {
    content: ' ‚Üï';
    opacity: 0.5;
}

th.sort-asc::after {
    content: ' ‚Üë';
    opacity: 1;
}

th.sort-desc::after {
    content: ' ‚Üì';
    opacity: 1;
}
```

3. **Add filter input** before the table:
```html
<div class="filter-box">
    <input type="text" id="tableFilter" placeholder="Filter by repository name, certification, or language..." onkeyup="filterTable()">
</div>
<table id="resultsTable">
```

4. **Add onclick handlers** to table headers:
```html
<thead>
    <tr>
        <th onclick="sortTable(0)">Repository</th>
        <th onclick="sortTable(1)">Score</th>
        <th onclick="sortTable(2)">Certification</th>
        <th onclick="sortTable(3)">Primary Language</th>
        <th onclick="sortTable(4)">Duration</th>
        <th onclick="sortTable(5)">Cached</th>
        <th>Reports</th>
    </tr>
</thead>
```

5. **Add data attributes** for numeric sorting:
```html
<td data-value="{{ result.assessment.overall_score }}">{{ "%.1f"|format(result.assessment.overall_score) }}</td>
<td data-value="{{ result.duration_seconds }}">{{ "%.1f"|format(result.duration_seconds) }}s</td>
```

6. **Add JavaScript** at the end of `<body>` before `</body>`:
```html
<script>
// Table sorting functionality
let sortDirections = {};

function sortTable(columnIndex) {
    const table = document.getElementById('resultsTable');
    const tbody = table.querySelector('tbody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    const headers = table.querySelectorAll('th');

    // Toggle sort direction
    const currentDir = sortDirections[columnIndex] || 'none';
    const newDir = currentDir === 'asc' ? 'desc' : 'asc';
    sortDirections[columnIndex] = newDir;

    // Update header indicators
    headers.forEach((h, i) => {
        h.classList.remove('sort-asc', 'sort-desc');
        if (i === columnIndex) {
            h.classList.add(`sort-${newDir}`);
        }
    });

    // Sort rows
    rows.sort((a, b) => {
        let aVal = a.cells[columnIndex].textContent.trim();
        let bVal = b.cells[columnIndex].textContent.trim();

        // Use data-value attribute if available (for numeric sorting)
        const aData = a.cells[columnIndex].getAttribute('data-value');
        const bData = b.cells[columnIndex].getAttribute('data-value');
        if (aData && bData) {
            aVal = parseFloat(aData);
            bVal = parseFloat(bData);
        } else {
            // Try numeric comparison first
            const aNum = parseFloat(aVal);
            const bNum = parseFloat(bVal);
            if (!isNaN(aNum) && !isNaN(bNum)) {
                aVal = aNum;
                bVal = bNum;
            }
        }

        if (aVal < bVal) return newDir === 'asc' ? -1 : 1;
        if (aVal > bVal) return newDir === 'asc' ? 1 : -1;
        return 0;
    });

    // Re-append sorted rows
    rows.forEach(row => tbody.appendChild(row));
}

// Table filtering functionality
function filterTable() {
    const input = document.getElementById('tableFilter');
    const filter = input.value.toLowerCase();
    const table = document.getElementById('resultsTable');
    const rows = table.querySelectorAll('tbody tr');

    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(filter) ? '' : 'none';
    });
}

// Initial sort by score (descending)
window.addEventListener('DOMContentLoaded', () => {
    sortTable(1); // Sort by score column
    sortTable(1); // Sort again to get descending order
});
</script>
```

**Verification**:
- Click column headers to verify sorting works
- Type in filter box to verify filtering works
- Verify initial load sorts by score descending

---

### Task 4: Implement Seaborn-Style Heatmap

**File**: `src/agentready/templates/multi_report.html.j2`

**Objective**: Create a visual heatmap showing attribute scores across repositories in seaborn style.

**Design Specifications**:
- **Axes**: Rows = Repositories, Columns = Top 10 Failing Attributes
- **Cell Content**: Score (0-100) with color gradient background
- **Color Scale**:
  - Pass (‚â•80): Green (#22c55e)
  - Partial (60-79): Yellow (#eab308)
  - Warning (40-59): Orange (#f97316)
  - Fail (<40): Red (#ef4444)
  - N/A: Gray (#cccccc)
- **Click Interaction**: Show remediation modal

**Implementation**:

1. **Add heatmap CSS**:
```css
/* Heatmap styles */
.heatmap-container {
    margin: 2rem 0;
    overflow-x: auto;
}

.heatmap {
    display: table;
    border-collapse: collapse;
    min-width: 100%;
}

.heatmap-row {
    display: table-row;
}

.heatmap-header {
    display: table-cell;
    background: var(--color-primary);
    color: white;
    font-weight: 600;
    padding: 0.75rem;
    text-align: center;
    border: 1px solid #fff;
}

.heatmap-row-label {
    display: table-cell;
    background: #f5f5f5;
    font-weight: 600;
    padding: 0.75rem;
    border: 1px solid var(--color-border);
    min-width: 150px;
}

.heatmap-cell {
    display: table-cell;
    text-align: center;
    padding: 0.75rem;
    border: 1px solid var(--color-border);
    min-width: 80px;
    font-weight: 600;
    cursor: pointer;
}

.heatmap-cell:hover {
    opacity: 0.8;
    box-shadow: 0 0 8px rgba(0,0,0,0.2);
}

.heatmap-legend {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin: 1rem 0;
    font-size: 0.85rem;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.legend-color {
    width: 30px;
    height: 20px;
    border-radius: 3px;
    border: 1px solid var(--color-border);
}
```

2. **Add heatmap section** after "Top Failing Attributes":
```jinja2
{% if batch_assessment.summary.top_failing_attributes and batch_assessment.results %}
<h2>üî• Attribute Failure Heatmap</h2>
<p class="section-intro">
    Visual overview of attribute scores across repositories. Cells show scores with color-coded backgrounds.
</p>
<div class="heatmap-legend">
    <div class="legend-item">
        <div class="legend-color" style="background-color: #22c55e;"></div>
        <span>Pass (‚â•80)</span>
    </div>
    <div class="legend-item">
        <div class="legend-color" style="background-color: #eab308;"></div>
        <span>Partial (60-79)</span>
    </div>
    <div class="legend-item">
        <div class="legend-color" style="background-color: #f97316;"></div>
        <span>Warning (40-59)</span>
    </div>
    <div class="legend-item">
        <div class="legend-color" style="background-color: #ef4444;"></div>
        <span>Fail (&lt;40)</span>
    </div>
    <div class="legend-item">
        <div class="legend-color" style="background-color: #cccccc;"></div>
        <span>N/A</span>
    </div>
</div>
<div class="heatmap-container">
    <div class="heatmap">
        <div class="heatmap-row">
            <div class="heatmap-header">Repository</div>
            {% for item in batch_assessment.summary.top_failing_attributes[:10] %}
            <div class="heatmap-header" title="{{ item['attribute_id'] }}">
                {{ item['attribute_id'][:15] }}{% if item['attribute_id']|length > 15 %}...{% endif %}
            </div>
            {% endfor %}
        </div>
        {% for result in batch_assessment.results %}
            {% if result.is_success() %}
            <div class="heatmap-row">
                <div class="heatmap-row-label">{{ result.assessment.repository.name }}</div>
                {% for attr_item in batch_assessment.summary.top_failing_attributes[:10] %}
                    {% set attr_id = attr_item['attribute_id'] %}
                    {% set finding = none %}
                    {% for f in result.assessment.findings %}
                        {% if f.attribute.id == attr_id %}
                            {% set finding = f %}
                        {% endif %}
                    {% endfor %}
                    {% if finding %}
                        {% set score = finding.score %}
                        {% if finding.status == 'not_applicable' %}
                            {% set color = '#cccccc' %}
                            {% set display = 'N/A' %}
                            {% set text_color = '#333' %}
                        {% elif score >= 80 %}
                            {% set color = '#22c55e' %}
                            {% set display = score|int %}
                            {% set text_color = 'white' %}
                        {% elif score >= 60 %}
                            {% set color = '#eab308' %}
                            {% set display = score|int %}
                            {% set text_color = 'white' %}
                        {% elif score >= 40 %}
                            {% set color = '#f97316' %}
                            {% set display = score|int %}
                            {% set text_color = 'white' %}
                        {% else %}
                            {% set color = '#ef4444' %}
                            {% set display = score|int %}
                            {% set text_color = 'white' %}
                        {% endif %}
                        <div class="heatmap-cell"
                             style="background-color: {{ color }}; color: {{ text_color }};"
                             title="{{ result.assessment.repository.name }} - {{ attr_id }}: {{ score|int }}/100">
                            {{ display }}
                        </div>
                    {% else %}
                        <div class="heatmap-cell" style="background-color: #cccccc;">N/A</div>
                    {% endif %}
                {% endfor %}
            </div>
            {% endif %}
        {% endfor %}
    </div>
</div>
{% endif %}
```

**Verification**:
- Verify heatmap renders with correct colors
- Verify tooltips show repository + attribute + score on hover
- Verify legend matches color scale

---

### Task 5: Convert to 2-Column Layout

**File**: `src/agentready/templates/multi_report.html.j2`

**Objective**: Use CSS Grid to display Language Distribution and Top Failing Attributes side-by-side.

**Implementation**:

1. **Add 2-column layout CSS**:
```css
.two-column-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    margin: 2rem 0;
}

@media (max-width: 1024px) {
    .two-column-layout {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
}
```

2. **Increase max-width** of container:
```css
.container {
    max-width: 1400px;  /* was 1200px */
    margin: 0 auto;
    background: var(--color-card);
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
```

3. **Wrap sections** in two-column div:
```jinja2
<div class="two-column-layout">
    <div>
        {% if batch_assessment.summary.language_breakdown %}
        <h2>üíª Language Distribution</h2>
        <p class="section-intro">Programming languages detected across all repositories.</p>
        <ul class="lang-list">
        {% for lang, count in batch_assessment.summary.language_breakdown.items() | sort(attribute='1', reverse=true) %}
            <li><strong>{{ lang }}</strong>: {{ count }} {{ 'file' if count == 1 else 'files' }}</li>
        {% endfor %}
        </ul>
        {% endif %}
    </div>

    <div>
        {% if batch_assessment.summary.top_failing_attributes %}
        <h2>‚ö†Ô∏è Top Failing Attributes</h2>
        <p class="section-intro">Most frequently failed attributes across all repositories.</p>
        <ul class="attr-list">
        {% for item in batch_assessment.summary.top_failing_attributes[:10] %}
            <li>
                <strong>{{ item['attribute_id'] }}</strong>:
                {{ item['failure_count'] }} {{ 'failure' if item['failure_count'] == 1 else 'failures' }}
            </li>
        {% endfor %}
        </ul>
        {% endif %}
    </div>
</div>
```

**Verification**:
- Verify sections appear side-by-side on wide screens
- Verify sections stack vertically on narrow screens (<1024px)

---

## Phase 3: Detailed Comparison Page (Future)

**File**: `src/agentready/templates/detailed_comparison.html.j2` (NEW)

**Objective**: Create a separate page showing all repositories with all attributes in a comprehensive heatmap.

**Deferred to Future**: This requires additional data preparation and a new reporter method. Implement after Phase 2 is complete and validated.

**Design**:
- 3x3 repository grid at top (supports up to 9 repos)
- Full heatmap: Rows = Repos (all assessed), Columns = ALL attributes (not just failing)
- Click cell to expand remediation guidance
- Filter controls (tier, category, pass/fail status)

---

## Testing Protocol

After implementing each task:

1. **Clear cache**: `rm -rf .agentready/cache`
2. **Regenerate report**: `agentready assess-batch --repos-file batch-repos.txt`
3. **Open report**: `open .agentready/batch/reports-*/index.html`
4. **Verify changes**: Check visual appearance and functionality
5. **Test interactions**: Click headers, filter, hover cells, etc.

**Test Data**: Use the existing 3-repository set:
- ambient-code/agentready (Silver)
- ambient-code/platform (Silver)
- ambient-code/spec-kit-rh (Bronze)

---

## Files to Modify

| File | Tasks | Priority |
|------|-------|----------|
| `src/agentready/templates/multi_report.html.j2` | 1, 2, 3, 4, 5 | P0 |

**No Python code changes required** - all improvements are template-only.

---

## Success Criteria

- ‚úÖ Each certification tier shows 2-3 sentence description
- ‚úÖ Repository table appears directly below certification section
- ‚úÖ Table is sortable by clicking any column header
- ‚úÖ Filter box filters table rows by text match
- ‚úÖ Heatmap displays with correct color gradients
- ‚úÖ Heatmap cells show scores and tooltips on hover
- ‚úÖ Language/Top Failing sections display side-by-side on wide screens
- ‚úÖ Layout is responsive (stacks on narrow screens)
- ‚úÖ All JavaScript works without external dependencies
- ‚úÖ CSP allows inline scripts (script-src 'unsafe-inline')

---

## Known Issues

1. **CSV Reporter Error**: `'Repository' object has no attribute 'primary_language'`
   - Impact: CSV generation fails but doesn't block HTML report
   - Fix: Add primary_language property or update CSV reporter
   - Priority: P2 (non-blocking)

2. **Git --no-hooks Reverting**: Linters may re-add the flag
   - Impact: Cloning fails on macOS
   - Workaround: Remove flag manually after linter runs
   - Fix: Add linter exception or update repository_manager.py permanently
   - Priority: P1 (blocks assessment)

---

## Quick Start

```bash
# 1. Navigate to project
cd /Users/jeder/repos/agentready

# 2. Activate virtual environment
source .venv/bin/activate

# 3. Edit template
# vim src/agentready/templates/multi_report.html.j2

# 4. Test changes
rm -rf .agentready/cache
agentready assess-batch --repos-file batch-repos.txt
open .agentready/batch/reports-*/index.html
```

---

**End of Cold-Start Implementation Plan**

*This plan is self-contained and can be executed by any LLM agent or developer without additional context.*
